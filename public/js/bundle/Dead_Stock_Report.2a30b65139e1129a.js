/*! For license information please see Dead_Stock_Report.2a30b65139e1129a.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8687],{23616:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h});var n=r(5947),a=r.n(n);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var i=n&&n.prototype instanceof c?n:c,d=Object.create(i.prototype);return s(d,"_invoke",function(r,n,a){var o,i,s,c=0,d=a||[],u=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return o=t,i=0,s=e,f.n=r,l}};function p(r,n){for(i=r,s=n,t=0;!u&&c&&!a&&t<d.length;t++){var a,o=d[t],p=f.p,h=o[2];r>3?(a=h===n)&&(s=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=p&&((a=r<2&&p<o[1])?(i=0,f.v=n,f.n=o[1]):p<h&&(a=r<3||o[0]>n||n>h)&&(o[4]=r,o[5]=n,f.n=h,i=0))}if(a||r>1)return l;throw u=!0,n}return function(a,d,h){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&p(d,h),i=d,s=h;(t=i<2?e:s)||!u;){o||(i?i<3?(i>1&&(f.n=-1),p(i,s)):f.n=s:f.v=s);try{if(c=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(u=f.n<0)?s:r.call(n,f))!==l)break}catch(t){o=e,i=1,s=t}finally{c=1}}return{value:t,done:u}}}(r,a,o),!0),d}var l={};function c(){}function d(){}function u(){}t=Object.getPrototypeOf;var f=[][n]?t(t([][n]())):(s(t={},n,function(){return this}),t),p=u.prototype=c.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,s(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return d.prototype=u,s(p,"constructor",u),s(u,"constructor",d),d.displayName="GeneratorFunction",s(u,a,"GeneratorFunction"),s(p),s(p,a,"Generator"),s(p,n,function(){return this}),s(p,"toString",function(){return"[object Generator]"}),(i=function(){return{w:o,m:h}})()}function s(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}s=function(e,t,r,n){function o(t,r){s(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},s(e,t,r,n)}function l(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){l(o,n,a,i,s,"next",e)}function s(e){l(o,n,a,i,s,"throw",e)}i(void 0)})}}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){f(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function f(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const p={metaInfo:{title:"Dead Stock Report"},data:function(){return{isLoading:!0,exporting:!1,serverParams:{sort:{field:"days_since_last_movement",type:"desc"},page:1,perPage:10},tableKey:0,limit:10,search:"",totalRows:0,range:{from:0,to:0},rows:[{children:[]}],period:60,periodOptions:[{value:30,text:this.$t("Last_30_days")},{value:60,text:this.$t("Last_60_days")},{value:90,text:this.$t("Last_90_days")}],warehouse_id:null,brand_id:null,category_id:null,_cancelSource:null}},computed:u(u({},(0,r(95353).L8)(["currentUser"])),{},{columns:function(){return[{label:this.$t("Code"),field:"code",sortable:!0,tdClass:"text-left",thClass:"text-left"},{label:this.$t("Product"),field:"product_name",sortable:!0,tdClass:"text-left",thClass:"text-left"},{label:this.$t("OnHand"),field:"on_hand",type:"number",headerField:this.sumOnHand,sortable:!0,tdClass:"text-left",thClass:"text-left"},{label:this.$t("LastMovement"),field:"last_movement_at",sortable:!0,tdClass:"text-left",thClass:"text-left"},{label:this.$t("DaysSinceLastMovement"),field:"days_since_last_movement",type:"number",sortable:!0,tdClass:"text-left",thClass:"text-left"}]},paginationOptions:function(){return{enabled:!0,mode:"records",perPage:this.serverParams.perPage,perPageDropdown:[10,20,50,100],dropdownAllowAll:!0,allText:"All",allLabel:"All",nextLabel:"next",prevLabel:"prev",setCurrentPage:this.serverParams.page}},disableExport:function(){return this.isLoading||this.exporting||!this.totalRows}}),methods:{sumOnHand:function(e){for(var t=0,r=(null==e?void 0:e.children)||[],n=0;n<r.length;n++){var a=Number(r[n].on_hand||0);isNaN(a)||(t+=a)}return t},updateParams:function(e){this.serverParams=Object.assign({},this.serverParams,e)},resetToFirstPageAndFetch:function(){var e;this.updateParams({page:1}),null!==(e=this.$refs.vgt)&&void 0!==e&&e.changePage&&this.$refs.vgt.changePage(1),this.fetchDeadStock(1)},onPageChange:function(e){var t=e.currentPage;this.updateParams({page:t}),this.fetchDeadStock(t)},onPerPageChange:function(e){var t,r=e.currentPerPage;this.limit=r,this.updateParams({perPage:r,page:1}),null!==(t=this.$refs.vgt)&&void 0!==t&&t.changePage&&this.$refs.vgt.changePage(1),this.fetchDeadStock(1)},onSortChange:function(e){e&&e[0]&&(this.updateParams({sort:{type:e[0].type,field:e[0].field}}),this.fetchDeadStock(this.serverParams.page))},onSearch:function(e){this.search=e.searchTerm||"",this.resetToFirstPageAndFetch()},onPeriodChange:function(){this.resetToFirstPageAndFetch()},_buildQuery:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.page,n=t.limitOverride,a=void 0===n?null:n,o=new URLSearchParams({page:String(null!==(e=null!=r?r:this.serverParams.page)&&void 0!==e?e:1),SortField:this.serverParams.sort.field||"days_since_last_movement",SortType:this.serverParams.sort.type||"desc",search:this.search||"",limit:String(null!==a?a:this.limit),period:String(this.period)});return this.warehouse_id&&o.append("warehouse_id",this.warehouse_id),this.brand_id&&o.append("brand_id",this.brand_id),this.category_id&&o.append("category_id",this.category_id),o},fetchDeadStock:function(){var e=arguments,t=this;return c(i().m(function r(){var n,o,s,l,c,d,u,f,p,h,v;return i().w(function(r){for(;;)switch(r.p=r.n){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:1,t._cancelSource&&"function"==typeof t._cancelSource.cancel&&t._cancelSource.cancel("New request triggered"),t._cancelSource=axios.CancelToken?axios.CancelToken.source():null,a().start(),a().set(.1),t.isLoading=!0,r.p=1,o=t._buildQuery({page:n}),s=t._cancelSource?{cancelToken:t._cancelSource.token}:{},r.n=2,axios.get("report/dead_stock?".concat(o.toString()),s);case 2:l=r.v,c=l.data,d=Array.isArray(c.report)?c.report:[],t.totalRows=Number(c.totalRows||0),t.rows[0].children=d,u=c.range||{},t.range={from:Number(u.from||(t.totalRows?1:0)),to:Number(u.to||Math.min(t.totalRows,(t.serverParams.page-1)*(-1===t.serverParams.perPage?t.totalRows:t.serverParams.perPage)+d.length))},t.tableKey+=1,r.n=4;break;case 3:r.p=3,v=r.v,null!==(f=(p=axios).isCancel)&&void 0!==f&&f.call(p,v)||(null===(h=t.$bvToast)||void 0===h||h.toast(t.$t("UnexpectedError")||"Unexpected error.",{variant:"danger",solid:!0}),console.error("Dead stock fetch error:",v));case 4:return r.p=4,a().done(),t.isLoading=!1,r.f(4);case 5:return r.a(2)}},r,null,[[1,3,4,5]])}))()},exportPdf:function(){var e=this;return c(i().m(function t(){var r,n,a,o;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!e.disableExport){t.n=1;break}return t.a(2);case 1:return e.exporting=!0,t.p=2,n=(null===(r=e.rows)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.children)||[],t.n=3,e._buildAndSavePdf(n,{suffix:"page"});case 3:t.n=5;break;case 4:t.p=4,o=t.v,null===(a=e.$bvToast)||void 0===a||a.toast(e.$t?e.$t("Export_Failed"):"Export failed. Please try again.",{variant:"danger",solid:!0}),console.error("PDF export error:",o);case 5:return t.p=5,e.exporting=!1,t.f(5);case 6:return t.a(2)}},t,null,[[2,4,5,6]])}))()},exportPdfAll:function(){var e=this;return c(i().m(function t(){var r,n,o,s,l,c,d,u,f;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!e.disableExport){t.n=1;break}return t.a(2);case 1:return e.exporting=!0,a().start(),a().set(.2),t.p=2,s=(null===(r=e._buildQuery)||void 0===r?void 0:r.call(e,{page:1,limitOverride:-1}))||new URLSearchParams({page:"1",limit:"-1",SortField:(null===(n=e.serverParams)||void 0===n||null===(n=n.sort)||void 0===n?void 0:n.field)||"last_movement_at",SortType:(null===(o=e.serverParams)||void 0===o||null===(o=o.sort)||void 0===o?void 0:o.type)||"asc",search:e.search||"",period:String(e.period),warehouse_id:e.warehouse_id||"",brand_id:e.brand_id||"",category_id:e.category_id||""}),t.n=3,axios.get("report/dead_stock?".concat(s.toString()));case 3:return l=t.v,c=l.data,d=Array.isArray(null==c?void 0:c.report)?c.report:[],t.n=4,e._buildAndSavePdf(d,{suffix:"all"});case 4:t.n=6;break;case 5:t.p=5,f=t.v,null===(u=e.$bvToast)||void 0===u||u.toast(e.$t?e.$t("Export_Failed"):"Export failed. Please try again.",{variant:"danger",solid:!0}),console.error("PDF export all error:",f);case 6:return t.p=6,a().done(),e.exporting=!1,t.f(6);case 7:return t.a(2)}},t,null,[[2,5,6,7]])}))()},_buildAndSavePdf:function(e){var t=arguments,n=this;return c(i().m(function a(){var o,s,l,c,d,u,f,p,h,v,g,m,_,b,y,P,S,w,x,O,C,k,$,F,D,j,A,T,L,z;return i().w(function(a){for(;;)switch(a.n){case 0:return s=(t.length>1&&void 0!==t[1]?t[1]:{}).suffix,l=void 0===s?"page":s,a.n=1,r.e(4733).then(r.bind(r,94733));case 1:return c=a.v,d=c.jsPDF,a.n=2,r.e(5708).then(r.bind(r,25708));case 2:u=a.v.default,f=new d({orientation:"landscape",unit:"pt",format:"A4"}),p="/fonts/Vazirmatn-Bold.ttf";try{f.addFont(p,"Vazirmatn","normal"),f.addFont(p,"Vazirmatn","bold")}catch(e){}f.setFont("Vazirmatn","normal"),h=n.$i18n&&["ar","fa","ur","he"].includes(n.$i18n.locale)||"undefined"!=typeof document&&"rtl"===document.documentElement.dir,g=(v=function(e,t){return n.$t?n.$t(e):t||e})("Dead_Stock_Report","Dead Stock Report"),m=(null===(o=(n.periodOptions||[]).find(function(e){return String(e.value)===String(n.period)}))||void 0===o?void 0:o.text)||{30:"Last 30 days",60:"Last 60 days",90:"Last 90 days"}[String(n.period)]||String(n.period),_=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name";if(!t)return v("All","All");var a=(e||[]).find(function(e){return String(e.id)===String(t)});return a&&(null!==(r=a[n])&&void 0!==r?r:a.name)||String(t)},b=n.warehouses?_(n.warehouses,n.warehouse_id,"name"):n.warehouse_id||v("All","All"),y=n.brands?_(n.brands,n.brand_id,"name"):n.brand_id||null,P=n.categories?_(n.categories,n.category_id,"name"):n.category_id||null,S=40,w=f.internal.pageSize.getWidth(),f.setFont("Vazirmatn","bold"),f.setFontSize(16),h?f.text(g,w-S,36,{align:"right"}):f.text(g,S,36),f.setFont("Vazirmatn","normal"),f.setFontSize(10),x=["".concat(v("Period","Period"),": ").concat(m),n.warehouse_id?"".concat(v("warehouse","Warehouse"),": ").concat(b):"".concat(v("warehouse","Warehouse"),": ").concat(v("All","All")),n.brand_id?"".concat(v("Brand","Brand"),": ").concat(y):null,n.category_id?"".concat(v("Category","Category"),": ").concat(P):null,n.search?"".concat(v("Search_this_table","Search"),': "').concat(n.search,'"'):null].filter(Boolean).join("   •   "),O=f.splitTextToSize(x,w-80),h?f.text(O,w-S,56,{align:"right"}):f.text(O,S,56),C=v("Code","Code"),k=v("Product","Product"),$=v("OnHand","On hand"),F=v("LastMovement","Last movement"),D=v("DaysSinceLastMovement","Days since last movement"),j=v("Never_Moved","Never Moved"),A=[[C,k,$,F,D]],T=(e||[]).map(function(e){var t,r,n;return[e.code||"",e.product_name||e.product||"","number"==typeof e.on_hand?String(e.on_hand):null!==(t=e.on_hand)&&void 0!==t?t:"",null!==(r=e.last_movement_at)&&void 0!==r?r:"—",e.last_movement_at?null!==(n=e.days_since_last_movement)&&void 0!==n?n:"":j]}),u(f,{startY:74,head:A,body:T,margin:{left:S,right:S},theme:"striped",styles:{font:"Vazirmatn",fontStyle:"normal",fontSize:9,cellPadding:6,overflow:"linebreak",halign:h?"right":"left"},headStyles:{font:"Vazirmatn",fontStyle:"bold",fillColor:[26,86,219],textColor:255,halign:h?"right":"left"},columnStyles:{2:{halign:"right"},4:{halign:"right"}},didDrawPage:function(e){f.setFont("Vazirmatn","normal"),f.setFontSize(8);var t=f.internal.pageSize.getHeight(),r="".concat(e.pageNumber," / ").concat(f.internal.getNumberOfPages());h?f.text(r,S,t-14,{align:"left"}):f.text(r,w-S,t-14,{align:"right"})}}),L=(new Date).toISOString().slice(0,19).replace(/[:T]/g,"-"),z="dead_stock_".concat(String(n.period),"_").concat(l,"_").concat(L,".pdf"),f.save(z);case 3:return a.a(2)}},a)}))()}},created:function(){this.fetchDeadStock(1)},beforeDestroy:function(){this._cancelSource&&"function"==typeof this._cancelSource.cancel&&this._cancelSource.cancel("Component destroyed")}};const h=(0,r(14486).A)(p,function(){var e=this,t=e._self._c;return t("div",{staticClass:"main-content"},[t("breadcumb",{attrs:{page:e.$t("Dead_Stock_Report"),folder:e.$t("Reports")}}),e._v(" "),e.isLoading?t("div",{staticClass:"loading_page spinner spinner-primary mr-3"}):t("b-card",{staticClass:"wrapper"},[t("div",{staticClass:"d-flex flex-wrap align-items-center mb-2"},[t("div",{staticClass:"mr-3 mb-2"},[t("label",{staticClass:"mb-0 mr-2"},[e._v(e._s(e.$t("Period"))+":")]),e._v(" "),t("b-form-select",{staticClass:"w-auto",attrs:{options:e.periodOptions,size:"sm"},on:{change:e.onPeriodChange},model:{value:e.period,callback:function(t){e.period=t},expression:"period"}})],1),e._v(" "),t("div",{staticClass:"ml-auto mb-2"},[t("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"outline-primary",disabled:e.disableExport},on:{click:e.exportPdf}},[e._v("\n          "+e._s(e.$t("Export"))+" PDF\n        ")]),e._v(" "),t("b-button",{attrs:{size:"sm",variant:"outline-secondary",disabled:e.disableExport},on:{click:e.exportPdfAll}},[e._v("\n          "+e._s(e.$t("Export"))+" PDF ("+e._s(e.$t("All"))+")\n        ")])],1)]),e._v(" "),t("div",{staticClass:"small text-muted mb-2"},[e._v("\n      "+e._s(e.$t("Showing"))+" "+e._s(e.range.from)+" – "+e._s(e.range.to)+" "+e._s(e.$t("of"))+" "+e._s(e.totalRows)+"\n    ")]),e._v(" "),t("vue-good-table",{key:e.tableKey,ref:"vgt",attrs:{mode:"remote",columns:e.columns,rows:e.rows,totalRows:e.totalRows,"group-options":{enabled:!0,headerPosition:"bottom"},"pagination-options":e.paginationOptions,"search-options":{placeholder:e.$t("Search_this_table"),enabled:!0},styleClass:"tableOne table-hover vgt-table mt-2"},on:{"on-page-change":e.onPageChange,"on-per-page-change":e.onPerPageChange,"on-sort-change":e.onSortChange,"on-search":e.onSearch},scopedSlots:e._u([{key:"table-row",fn:function(r){return["last_movement_at"===r.column.field?t("span",[e._v("\n          "+e._s(r.row.last_movement_at||"—")+"\n        ")]):"days_since_last_movement"===r.column.field?t("span",[r.row.last_movement_at?t("span",[e._v(e._s(r.row.days_since_last_movement))]):t("b-badge",{attrs:{variant:"warning"}},[e._v("\n            "+e._s(e.$t("Never_Moved"))+"\n          ")])],1):t("span",[e._v("\n          "+e._s(r.formattedRow[r.column.field])+"\n        ")])]}}])})],1)],1)},[],!1,null,null,null).exports}}]);